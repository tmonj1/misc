# How to use semantic version in .NET Core 3

- [1. tl;dr;](#1-tldr)
  - [1.1 Set semantic version](#11-set-semantic-version)
  - [1.2 Get semantic version](#12-get-semantic-version)
- [2. Versioning of .NET Core](#2-versioning-of-net-core)
  - [2.1 Versioning of .NET Core Runtime and SDK](#21-versioning-of-net-core-runtime-and-sdk)
  - [2.2 Versioning of NuGet Packages](#22-versioning-of-nuget-packages)
  - [2.3 Versioning of custom applications and assemblies](#23-versioning-of-custom-applications-and-assemblies)
  - [2.4 Advanced topics](#24-advanced-topics)
- [3. Version in detail](#3-version-in-detail)
  - [3.1 Version-setting structure](#31-version-setting-structure)
  - [3.2 How versions are generated](#32-how-versions-are-generated)
- [4. Resources](#4-resources)

---

## 1. tl;dr;

For the semantic version<sup>[1](#1)</sup> `1.2.3-beta-4` for the assembly `CompanyName.ProductName.Whatsoever`, set `AssemblyName`, `VersionPrefix` and `VersionSuffix` in your .csproj file (or, `Directory.Build.props` is even better) as shown below:

### 1.1 Set semantic version

```XML
  <PropertyGroup>
    <AssemblyName>CompanyName.ProductName.Whatsoever</AssemblyName>
    <VersionPrefix>1.2.3</VersionPrefix>
    <VersionSuffix>beta-4</VersionSuffix>
  </PropertyGroup>
```

### 1.2 Get semantic version

Use `GetInformationalVersion` method on `Assembly` object, as shown below:

```CSharp
var infoVer = Assembly
    .GetEntryAssembly()
    .GetCustomAttribute(typeof(AssemblyInformationalVersionAttribute))
    as AssemblyInformationalVersionAttribute
var semver = infoVer.InformationalVersion;
```
## 2. Versioning of .NET Core

### 2.1 Versioning of .NET Core Runtime and SDK

* .NET Core Runtime (roughly) follows semantic versioning.<sup>[2](#2)</sup>
* .NET Core SDK does not follow semantic versioning, but has the same major and minor
version with the correspondent .NET Runtime.<sup>[2](#2)</sup>

### 2.2 Versioning of NuGet Packages

* NuGet packages support semantic versioning.<sup>[3](#3)</sup>
* See also [Source Link](https://docs.microsoft.com/ja-jp/dotnet/standard/library-guidance/sourcelink)<sup>[4](#4)</sup>
* use &lt;PackageVersion> for NuGet packages, instead of &lt;Version><sup>[5](#5)</sup>

### 2.3 Versioning of custom applications and assemblies

* It would be better to use semantic versioning
* .NET Runtime uses assembly version when loading assemblies (and ignore anything else)
* Windows uses assembly file version to uniquely identify an assembly (and ignore anything else)
* Assembly version and assembly file version must conform to 4 digit format (major.minor.patch.build), which are automatically generated from `VersionPrefix` (VersionSuffix is ignored) with `0` added to the fourth digit (so, the forth digit is always 0).

### 2.4 Advanced topics

* There are some tools for auto versioning:
  * Visual Studio
  * [MSBump](https://github.com/BalassaMarton/MSBump)
  * [GitVersioning](https://github.com/dotnet/Nerdbank.GitVersioning)

## 3. Version in detail

### 3.1 Version-setting structure

| Name                  | Default                 | Format       | Description                 |
| :-------------------- | :---------------------- | :----------- | :-------------------------- |
| Informational Version | 1.0.0                   | any          | VersionPrefix+VersionSuffix |
| Version               | Informational Version   | 3 or 4 digit |                             |
| Package Version       | Version                 | semver       | Nuget versioning uses this. |
| Assembly Version      | Version (no prerelease) | 4 digit      | .NET runtime uses this.     |
| Assembly File Version | Version (no prerelease) | 4 digit      | Windows uses this.          |

* source: [What is the difference between various MSBuild version properties, such as Version, VersionPrefix, and VersionSuffix?](https://stackoverflow.com/questions/42183300/what-is-the-difference-between-various-msbuild-version-properties-such-as-versi)

So, it is OK to only set VersionPrefix and VersionSuffix, others are generated automatically from these.

* sidenote: There are a few properties controlling auto generation of versions such as `GenerateAssemblyVersionAttribute`, but these are all set to `true` by default, so you can safely ignore them.

### 3.2 How versions are generated

When an assembly is built, an `AssemblyInfo.cs` file is generated by the compiler and emitted to `bin/Debug` directory (on debug build), according to the settings in `.csproj` (or, Directory.Build.Props).

In multiple project structure, if there is `Directory.Build.Props` in one of ancestor directories, it is used for all assemblies in its subtree (in this case, `.csproj` file in each projecct is ignored).

## 4. Resources

1. <a name="1">(Semantic Versioning 2.0.0)[https://semver.org/spec/v2.0.0.html]</a>
2. <a name="2">[Overview of how .NET Core is versioned](https://docs.microsoft.com/ja-jp/dotnet/core/versions/)</a>
3. <a name="3">[Package versioning](https://docs.microsoft.com/en-us/nuget/concepts/package-versioning)</a>
4. <a name="4">[Source Link](https://docs.microsoft.com/ja-jp/dotnet/standard/library-guidance/sourcelink)</a>
5. <a name="5">[NuGet](https://docs.microsoft.com/ja-jp/dotnet/standard/library-guidance/nuget)</a>
6. <a name="6">[Semantic versioning for dotnet application](https://kimsereyblog.blogspot.com/2018/04/sementic-versioning-for-dotnet.html)</a>